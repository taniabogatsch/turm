<!-- template containing the participants managment -->

{{template "header.html" .}}

{{template "manage/templates/leftNav.html" . }}

<div class="page page-middle">
  <div class="tab-content">

    <h4>
      <!-- show either an open draft or an open course -->
      {{template "icons/people.html" . }}
      &nbsp; Teilnehmerverwaltung
    </h4>
    <hr>

    {{if .errMsg}}
      <div class="val-div w-100 text-danger">
        {{.errMsg}}
      </div>
    {{else}}

      <!-- title -->
      <div class="row">
        <div class="col">
          <h4>
            {{.participants.Title}}
          </h4>
        </div>
      </div>
      <hr>

      <div class="row">
        <div class="col-sm-3">
          Einschreibestart:
          <br>
          {{.participants.EnrollmentStart}}
        </div>
        <div class="col-sm-3">
          Einschreibeende:
          <br>
          {{.participants.EnrollmentEnd}}
        </div>
        <div class="col-sm-3">
          Austragen bis:
          <br>
          {{if .participants.UnsubscribeEnd.Valid}}
            {{.participants.UnsubscribeEnd.String}}
          {{else}}
            -
          {{end}}
        </div>
        <div class="col-sm-3">
          Ablaufdatum:
          <br>
          {{.participants.ExpirationDate}}
        </div>
      </div>
      <hr>

      <div class="row">
        <div class="col-sm-6">
          <button type="button" class="btn btn-outline-darkblue w-100"
            data-toggle="modal" data-target="#download-participants-modal">
            {{template "icons/download.html" . }}
            &nbsp; Listen herunterladen
          </button>
        </div>
        <div class="col-sm-6">
          <button type="button" class="btn btn-outline-darkblue w-100"
            data-toggle="modal" data-target="#email-participants-modal">
            {{template "icons/envelope.html" . }}
            &nbsp; E-Mail senden
          </button>
        </div>
      </div>
      <hr>
      <br>

      <h5>
        <div class="d-inline">
          Veranstaltung: &nbsp;
        </div>
        <div class="d-inline">
          <select class="custom-select w-auto" id="parts-select-event">
            {{range $k, $v := .participants.Lists}}
              <option value="{{.ID}}" {{if eq $k 0}}selected{{end}}>{{.Title}}</option>
            {{end}}
          </select>
        </div>
      </h5>

      <!-- range events and their participants -->
      {{range $k, $v := .participants.Lists}}
        <div class="collapse select-option select-option-{{.ID}}">
          <!-- TODO: field for manual enrollment of users -->
          TeilnehmerInnen: {{.Fullness}}/{{.Capacity}}
          {{if .Annotation.Valid}}
            <br>
            Anmerkung: {{.Annotation.String}}
          {{end}}
          <hr>
          <br>
          <h5>
            {{template "icons/people.html" . }}
            &nbsp; Teilnehmerliste
          </h5>
          <hr>
          {{template "participants/list.html" dict_addLocale $.currentLocale "list" .Participants}}
          <hr>
          <br>
          <h5>
            {{template "icons/clock.html" . }}
            &nbsp; Wartelist
          </h5>
          <hr>
          {{template "participants/list.html" dict_addLocale $.currentLocale "list" .Waitlist}}
          <hr>
          <br>
          <h5>
            {{template "icons/arrowRightIn.html" . }}
            &nbsp; Ausgetragene TeilnehmerInnen
          </h5>
          <hr>
          {{template "participants/list.html" dict_addLocale $.currentLocale "list" .Unsubscribed}}
        </div>
      {{end}}

    {{end}}
  </div>
</div>

<div class="page page-side">
  <div class="page-right-layout">
    <small class="text-muted">
      TODO
    </small>
  </div>
</div>

{{template "participants/modals/download.html" .}}
{{template "participants/modals/email.html" .}}

<script src="/public/js/participants.js"></script>

<script>
  $(function() {
    //adjust the nav pills
    {{if not .participants.Expired}}
      $('#pills-opened-draft').addClass("d-none");
      $('#pills-opened-active').removeClass("d-none");
      $('#pills-opened-expired').addClass("d-none");
    {{else}}
      $('#pills-opened-draft').addClass("d-none");
      $('#pills-opened-active').addClass("d-none");
      $('#pills-opened-expired').removeClass("d-none");
    {{end}}

    //on change hide all divs linked to select and show only linked to selected option
    $('#parts-select-event').change(function(){
      //get the wanted div
      let selector = '.select-option-' + $(this).val();
      //hide all elements
      $('.select-option').collapse('hide');
      //show element connected to selected option
      $(selector).collapse('show');
    });

    //
    let selector = '.select-option-' + $('#parts-select-event').val();
    $('.select-option').collapse('hide');
    $(selector).collapse('show');

    //download and e-mail modal
    toggleEventSelection('selector-events-email');
    toggleEventSelection('selector-events-download');
  });
</script>

{{template "footer.html" .}}
